let e,t,s,o,a,i,r,n,l,u,m,c={platform:{twitch:!0,youtube:!1},id:"alice",koofee:"",symbol:"$",usersForce:["fiatiine","sayonani","helba_the_ai"],timeSaveCooldown:1e3},d={keys:["hours","minutes","seconds"],counting:{hours:[],minutes:[],seconds:[]},previous:{hours:[],minutes:[],seconds:[]}},p={rewards:["Speed Art Challenge","Trivia Time","Quick Clip Compilation","Mini Game Tournament","Gamer Postcard Giveaway","Speedrun Challenge","In-Game Item Drop","Quick Cosplay","Community Shoutout","Backstory Build"]},f={rewards:[],numbers:[],mystery:[],origin:[]},b={rewards:[],numbers:[],mystery:[],origin:[]},h={startup:!0,welcome:{name:"event",number:"info"},status:[],style:"stack",setLockZero:!1,setTimerMax:!1,setTimerMaxCheck:!1,setTimerDivider:!0,setManualTime:0,countTimerMax:Q("24:00"),countTimerWarning:Q("1:00"),countTimerReset:Q("10:00"),countTimerCustom:Q("24:00"),modePowerup:{multiplier:1,multiplierEvent:1,events:[],commandEnable:"!powerupon",commandDisable:"!powerupoff",permissions:{mods:!0,users:["fiatiine","sayonani","helba_the_ai"]}},modeSleep:{multiplier:1,multiplierReset:.25,commandEnable:"!sleepon",commandDisable:"!sleepoff",permissions:{mods:!0,users:["fiatiine","sayonani","helba_the_ai"]}},values:{subs:{tier1:"60s",tier2:"90s",tier3:"120s"},gift:{tier1:"60s",tier2:"90s",tier3:"120s"},kofi:{tips:"60s",subs:"60s"},tips:"30s",bits:"30s",follow:"0s",raid:"0s",members:"60s",superchat:"60s"},confetti:{zero:{enable:!0,loop:5,count:350,color:"#ffacff",emotes:{images:["","",""],size:5}},maxed:{enable:!1,loop:1,count:150,color:"#b6a2ff",emotes:{images:["","",""],size:5}}},commands:{resume:"!resume",pause:"!pause",add:"!add",subtract:"!subtract",lock:{commandEnable:"!lock",commandDisable:"!unlock"},permissions:{mods:!0,users:["fiatiine","sayonani","helba_the_ai"]}},audio:{resume:{path:"brain/audio/FN-Megathon-Timer-Resume.mp3",volume:.5},pause:{path:"brain/audio/FN-Megathon-Timer-Pause.mp3",volume:.5},zero:{path:"brain/audio/FN-Megathon-Timer-Zero.mp3",volume:.5}}},g={enable:!0,testing:!1,emulate:"complete",style:"deplete",status:"rolling",countChance:20,countLoopMax:20,timeRoll:12e5,timeExit:5e3,timeWarning:"1:00",timeExpire:"10:00",infoSubtitle:"new quest",infoFailed:"quest failed",infoComplete:"quest complete",infoBubbleLabel:"subs",previous:"",points:{subs:{tier1:1,tier2:2,tier3:3},gift:{tier1:1,tier2:2,tier3:3},kofi:{tips:1,subs:1},tips:1,bits:1,follow:1,raid:1},effects:{enable:!0},confetti:{enable:!0,loop:1,count:50,color:"#a7ebb3",emotes:{images:["https://static-cdn.jtvnw.net/emoticons/v2/307918664/static/light/3.0","https://static-cdn.jtvnw.net/emoticons/v2/307918623/static/light/3.0","https://static-cdn.jtvnw.net/emoticons/v2/307918654/static/light/3.0"],size:3}},commands:{commandEnable:"!questson",commandDisable:"!questsoff",permissions:{mods:!0,users:["fiatiine","sayonani","helba_the_ai"]}},audio:{appear:{path:"brain/audio/FN-Megathon-Quest-Appear.wav",volume:.5},warning:{path:"brain/audio/FN-Megathon-Quest-Warning.wav",volume:.5},failed:{path:"brain/audio/FN-Megathon-Quest-Failed.wav",volume:.5},complete:{path:"brain/audio/FN-Megathon-Quest-Complete.wav",volume:.5}},audioOnce:!0},w={startup:!0,reveal:"before",particleColor:"#eae4ff",setPrefix:"",setSuffix:"",countPoints:0,countShowTotal:5,countShowCompleted:2,countLastMilestone:f.numbers.at(-1),commands:{commandAdd:"!addgoal",commandRemove:"!removegoal",commandReset:"!resetgoals",permissions:{mods:!0,users:["fiatiine","sayonani","helba_the_ai"]}}},v={style:"stack",styleData:"milestones",enableDecimals:!1,countPoints:0,countPointsMax:0,countProgressCurrent:0,countProgressPrevious:0,setManualPoints:0,points:{subs:{tier1:1,tier2:2,tier3:3},gift:{tier1:1,tier2:2,tier3:3},kofi:{tips:1,subs:1},tips:1,bits:1,follow:1,raid:1},commands:{add:"!addpoints",subtract:"!subtractpoints",set:"!setpoints",reset:"!resetpoints",permissions:{mods:!0,users:["fiatiine","sayonani","helba_the_ai"]}}},C=[...p.rewards];const P=$(".reward-belt").clone();P.find(".reward.fake").remove();const k=P.html(),T=$(".bar").first().html(),y=$(".timer").hasClass("show"),x=$(".quest").hasClass("show"),S=$(".milestones").hasClass("show"),E=$(".progress").hasClass("show"),M=$(".effects").hasClass("show"),R=y||x||E||S||M,q=y||x||E;function _(e,t){const s=[];for(let o=1;o<=50;o++){const a=e[`${t}${String(o).padStart(2,"0")}`];s.push(a),"msRewards_"==t&&f.origin.push("fields")}return s}function I(){clearTimeout(m),console.log("%c✨ SAVING... waiting for cooldown... 10s","color: #f9c23c"),m=setTimeout((function(){SE_API.store.get("fn_megathon_bubblepop").then((e=>{y&&(e.status=[...h.status],SE_API.store.set("fn_megathon_bubblepop",e)),S&&(e.milestones={...f},e.milestonesStretch={...b},SE_API.store.set("fn_megathon_bubblepop",e)),E&&(e.countPoints=v.countPoints,SE_API.store.set("fn_megathon_bubblepop",e)),console.log("%c✨ SE HISTORY SAVED","color: #f9c23c",e)}))}),c.timeSaveCooldown)}function O(e,t,s){"string"==typeof t&&(t=[t]);const o=!t||0===t.length||t.every((e=>!e.trim()));if(o)return void console.log(`%c${e}`,`color: #fff; background-color: ${s}; padding: 2px 8px; border-radius: 3px;`);const a=function(e,t){e=e.replace("#","");const s=parseInt(e.substring(0,2),16),o=parseInt(e.substring(2,4),16),a=parseInt(e.substring(4,6),16);return`rgba(${s}, ${o}, ${a}, ${t})`}(s,.1),i=t.map((e=>`%c${e}%c`)).join(" "),r=t.flatMap((e=>[`color: ${s}; background-color: ${a}; padding: 2px 8px; border-radius: 3px;`,""])),n=[`color: #fff; background-color: ${s}; padding: 2px 8px; border-radius: 3px;`,`color: ${s}`,...r];console.log(`%c${e}%c${o?"":" →"} ${i}`,...n)}function A(t,s,o,a){if(console.log(t,s,o,a),y){let i=s?z(s).all:0;switch(t){case"add":s&&r();break;case"subtract":s&&e.subtractTime(i,o,a);break;case"reset":ee(),X("all"),J("powerup",!1),J("sleep",!1),J("lock",!1),e.resetTime(i);break;case"custom":ee(),e.resetTime(i);break;case"resume":$(".timer").removeClass("timer-reset"),$(".timer").removeClass("timer-pause"),$(".timer").removeClass("timer-maxed"),$(".timer").removeClass("timer-zero"),e.resumeTimer();break;case"pause":$(".timer").addClass("timer-pause"),e.pauseTimer()}function r(){if(h.status.includes("lock"))$(".status.lock").removeClass("shake"),setTimeout((function(){$(".status.lock").addClass("shake")}),100);else{$(".timer").removeClass("timer-zero"),$(".status.lock").removeClass("shake");const t=z(W(i)*h.modePowerup.multiplierEvent*h.modeSleep.multiplier).all;n(t),e.adjustTime(t,o,a)}}function n(e){clearTimeout(l),clearTimeout(u),$(".bubble-timer.small").removeClass("enter exit"),l=setTimeout((function(){$(".bubble-timer.small").addClass("enter"),$(".bubble-timer.small .bubble-number").text(e)}),100),u=setTimeout((function(){$(".bubble-timer.small").addClass("exit")}),2e3)}i=0}}function N(e){switch(e){case"timer-zero":t.triggerEvent(fn={megathon_bubblepop:{timerConfettiZero:!0}});break;case"quest-appear":t.triggerEvent(fn={megathon_bubblepop:{questAppear:!0}});break;case"quest-warning":t.triggerEvent(fn={megathon_bubblepop:{questWarning:!0}});break;case"quest-failed":t.triggerEvent(fn={megathon_bubblepop:{questFailed:!0}});break;case"quest-complete":t.triggerEvent(fn={megathon_bubblepop:{questComplete:!0}});break;case"quest-exit":t.triggerEvent(fn={megathon_bubblepop:{questExit:!0}});break;case"progress-pointsTotal":t.triggerEvent(fn={megathon_bubblepop:{pointsTotal:v.countPoints}});break;case"milestones-list":t.triggerEvent(fn={megathon_bubblepop:{milestones:f}})}}function D(e){$(e).each((function(e,t){const s=$(t).text().split("");$(t).html(""),$(s).each((function(e,s){const o="<span>"+s+"</span>";$(t).append(o)," "==s&&$(t).find("span").last().addClass("space")}))}))}function L(e,t,s){$(e).each((function(e,o){const a=$(o).find("span").length;$(o).find("span").each((function(e,o){const i=parseFloat(((t/a*e+(s||0))/1e3).toFixed(2));$(o).css("animation-delay",i+"s")}))}))}function F(e){let t=$(e).outerWidth(!0),s=$(e).parent().outerWidth(!0),o=s/t;t>s?$(e).css("transform","scale("+o+")"):$(e).css("transform","")}function z(e){const t=Number(e),s=Math.floor(t/3600),o=Math.floor(t%3600/60),a=Math.floor(t%60);let i="";return s>0&&(i+=`${s}h`),o>0&&(i+=`${o}m`),(a>0||0===s&&0===o)&&(i+=`${a}s`),{h:s<10?`0${s}`:`${s}`,m:o<10?`0${o}`:`${o}`,s:a<10?`0${a}`:`${a}`,all:i.trim()}}function W(e){let t=e.match(/(\d+h|\d+m|\d+s)/g),s=0;return t.forEach((e=>{let t=parseFloat(e);switch(e.match(/[a-zA-Z]+/)[0]){case"h":s+=3600*t;break;case"m":s+=60*t;break;case"s":s+=t}})),s}function Q(e){const[t,s]=e.split(":").map(Number);return 3600*t+60*s}function U(e){let[t,s]=e.split(":").map(Number);return t=t.toString().padStart(2,"0"),s=s.toString().padStart(2,"0"),`${t}:${s}`}function V(e){const t=e.replace(/\D/g,"");return parseInt(t)}function B(e){const t=Math.floor(Math.random()*e.length);return[e[t],t]}function G(e){return e.split(",")}function K(e){switch(parseInt(e)){case 0:default:userReturn=!1;break;case 1:userReturn=!0}return userReturn}function j(e,t,s){function o(){switch(s){case"timer-zero":confetti({spread:360,ticks:100,gravity:0,decay:.94,startVelocity:30,particleCount:h.confetti.zero.count,scalar:.8,shapes:["circle"],colors:h.confetti.zero.color}),confetti({spread:360,ticks:200,gravity:1,decay:.94,startVelocity:30,particleCount:20,scalar:h.confetti.zero.emotes.size,shapes:["image"],shapeOptions:{image:[{src:h.confetti.zero.emotes.images[0],width:32,height:32},{src:h.confetti.zero.emotes.images[1],width:32,height:32},{src:h.confetti.zero.emotes.images[2],width:32,height:32}]}});break;case"timer-maxed":confetti({spread:360,ticks:100,gravity:0,decay:.94,startVelocity:30,particleCount:h.confetti.maxed.count,scalar:.8,shapes:["circle"],colors:h.confetti.maxed.color}),confetti({spread:360,ticks:200,gravity:1,decay:.94,startVelocity:30,particleCount:20,scalar:h.confetti.maxed.emotes.size,shapes:["image"],shapeOptions:{image:[{src:h.confetti.maxed.emotes.images[0],width:32,height:32},{src:h.confetti.maxed.emotes.images[1],width:32,height:32},{src:h.confetti.maxed.emotes.images[2],width:32,height:32}]}});break;case"quest":confetti({spread:360,ticks:100,gravity:0,decay:.94,startVelocity:30,particleCount:50,scalar:.8,shapes:["circle"],colors:g.confetti.color}),confetti({spread:360,ticks:200,gravity:1,decay:.94,startVelocity:30,particleCount:20,scalar:g.confetti.emotes.size,shapes:["image"],shapeOptions:{image:[{src:g.confetti.emotes.images[0],width:32,height:32},{src:g.confetti.emotes.images[1],width:32,height:32},{src:g.confetti.emotes.images[2],width:32,height:32}]}})}}t&&(countConfetti=1),e?countConfetti<=e&&(countConfetti++,o(),setTimeout((function(){j(e,!1,s)}),1e3)):o()}function Z(e){const t=$(".audio-"+e);if(y&&!h.status.includes("sleep"))switch(t.get(0).play(),e){case"timer-resume":t.prop("volume",h.audio.resume.volume);break;case"timer-pause":t.prop("volume",h.audio.pause.volume);break;case"timer-zero":t.prop("volume",h.audio.zero.volume)}if(x)switch(t.get(0).play(),e){case"quest-appear":t.prop("volume",g.audio.appear.volume);break;case"quest-warning":t.prop("volume",g.audio.warning.volume);break;case"quest-failed":t.prop("volume",g.audio.failed.volume);break;case"quest-complete":t.prop("volume",g.audio.complete.volume)}}function Y(e){if(y){d.counting.hours=z(e).h.split("").map(Number),d.counting.minutes=z(e).m.split("").map(Number),d.counting.seconds=z(e).s.split("").map(Number);let t=z(e).h,s=(z(e).m,z(e).s);$(".timer").toggleClass("timer-swap",0==t),$(".time-row.top .time").toggleClass("hours",0!=t),$(".time-row.top .time").toggleClass("minutes",0==t),$(".time-row.btm .time").toggleClass("minutes",0!=t),$(".time-row.btm .time").toggleClass("seconds",0==t),$(d.keys).each((function(e,t){const s=$("."+t);$(d.counting[t]).each((function(e,o){if(o!=d.previous[t][e]){d.previous[t][e]=o;let a=s.find("span").eq(e);a.removeClass("enter exit"),a.addClass("exit"),a.length?setTimeout((function(){a.addClass("enter"),a.text(o),F("."+t+" .size")}),300):setTimeout((function(){a.addClass("enter"),s.find(".size").append("<span>"+o+"</span>"),F("."+t+" .size")}),300)}})),s.find("span").slice(d.counting[t].length).remove(),L("."+t,200),d.counting[t].length<d.previous[t].length&&(d.previous[t].length=d.counting[t].length)})),$(".theme").hasClass("set-timer-stack")&&(0==t?(d.previous.hours=[],$(".drawer-wrap").addClass("drawer-close")):$(".drawer-wrap").removeClass("drawer-close")),$(".theme").hasClass("set-timer-wide")&&(0==t?(d.previous.hours=[],$(".drawer-wrap").addClass("drawer-close")):$(".drawer-wrap").removeClass("drawer-close"));let o=6*(60-s);$(".raw-seconds").text(s),$(".knob").toggleClass("seamless",59!=s),$(".knob").css("transform","rotate("+o+"deg)")}}function H(e,t,s,o){!h.status.includes("lock")&&o&&($(".card-event").removeClass("enter exit"),setTimeout((function(){$(".theme").removeClass("subs gift bits tips follow"),$(".theme").addClass(s),$(".card-event").addClass("enter"),$(".card-rotate").css("transform",`rotate(${(20*Math.random()-10).toFixed(2)}deg)`),"tips"==s?($(".event.name").text(e),$(".event.number").text(c.symbol+t)):($(".event.name").text(e),$(".event.number").text(t))}),100))}function J(e,t,s,i,r){"powerup"==e&&(t?($(".bubble-timer.large").removeClass("enter exit"),$(".bubble-timer.large").addClass("enter"),s&&($(".bubble-timer.large .bubble-number").text(s),h.modePowerup.multiplier=s),i?($(".loop-wrap-small").show(0),function(e){const t=W(e);a=W(e),$(".loop-progress-small").css("stroke-dashoffset",""),clearInterval(o),o=setInterval((()=>{let e=(48*(1-a/t)).toFixed(2);$(".loop-progress-small").css("stroke-dashoffset",e),a>0?a--:(clearInterval(o),J("powerup",!1))}),1e3)}(i)):$(".loop-wrap-small").hide(0),r&&(h.modePowerup.events=[...r])):($(".bubble-timer.large").addClass("exit"),h.modePowerup.multiplier=1,h.modePowerup.multiplierEvent=1,h.modePowerup.events=[],clearInterval(o))),("sleep"==e||"load"==e&&h.status.includes("sleep"))&&(t?($(".status.moon").removeClass("enter exit"),$(".status.moon").addClass("enter"),h.modeSleep.multiplier=h.modeSleep.multiplierReset,h.status.includes("sleep")||(h.status.push("sleep"),I())):($(".status.moon").addClass("exit"),h.modeSleep.multiplier=1,X("sleep"),I())),("lock"==e||"load"==e&&h.status.includes("lock"))&&(t?($(".status.lock").removeClass("enter exit"),$(".status.lock").addClass("enter"),h.status.includes("lock")||(h.status.push("lock"),I())):($(".status.lock").removeClass("shake"),$(".status.lock").addClass("exit"),X("lock"),I())),h.status.includes("sleep")&&h.status.includes("lock")?($(".status").hide(0),$(".status.lock").show(0)):$(".status").show(0)}function X(e){if("all"==e)d.status=[];else{let t=h.status.indexOf(e);-1!==t&&h.status.splice(t,1)}}function ee(e){switch(e){case"hours":d.previous.hours=[];break;case"minutes":d.previous.minutes=[];break;case"seconds":d.previous.seconds=[];break;default:d.previous.hours=[],d.previous.minutes=[],d.previous.seconds=[]}}function te(e){const t=Math.round(100*Math.random());clearTimeout(n),"rolling"==g.status&&(t<=g.countChance||e?(console.clear(),console.log("%c✨ QUEST → ROLL %cSUCCESS ["+g.countChance+"]["+t+"]","color: #fff","color: #a7ebb3"),g.enable&&(g.status="playing",$(".theme").removeClass("quest-failed quest-warning quest-complete quest-update"),$(".theme").removeClass("enter exit"),$(".theme").addClass("enter"),e||N("quest-appear"),$(".quest").show(0),$(".quest-timer").text(U(g.timeExpire)),$(".bubble-number").text(g.countLoopMax),$(".loop-count").text("0"),function(e){const[t,s]=e.split(":").map(Number),[o,a]=g.timeWarning.split(":").map(Number),n=60*o+a;r=60*t+s,$(".quest-subtitle").text(g.infoSubtitle),clearInterval(i),i=setInterval((()=>{const e=U(Math.floor(r/60)+":"+r%60);$(".quest-timer").text(e),r<=n&&($(".theme").hasClass("quest-warning")||N("quest-warning"),$(".theme").addClass("quest-warning"),g.audioOnce&&(g.audioOnce=!1,Z("quest-warning"))),r>0?r--:($(".theme").addClass("quest-failed"),N("quest-failed"),$(".quest-subtitle").text(g.infoFailed),oe(),ie(),Z("quest-failed"))}),1e3)}(g.timeExpire),se(),D(".quest-title"),L(".quest-title",500),Z("quest-appear"),g.audioOnce=!0)):(console.log("%c✨ QUEST → ROLL %cFAILED ["+g.countChance+"]["+t+"]","color: #fff","color: #ff5353"),$(".quest-title").text("ROLL FAILED ["+g.countChance+"]["+t+"]"),n=setTimeout((function(){te()}),g.timeRoll)))}function se(){if(0==C.length&&(C=[...p.rewards]),"default"==g.style){const e=B(C)[0];1===C.length||g.previous!==e?(g.previous=e,$(".quest-title").text(e)):se()}if("deplete"==g.style){const e=C.splice(B(C)[1],1)[0];$(".quest-title").text(e),console.log("%c✨ QUEST → ITEM %c"+e,"color: #fff","color: #a7ebb3"),console.log(C)}}function oe(){clearInterval(i)}function ae(e){let t=parseFloat($(".loop-count").text()),s=Math.floor(t+=e),o=(189-s/g.countLoopMax*189).toFixed(2);"playing"!=g.status||$(".theme").hasClass("quest-failed")||($(".theme").removeClass("quest-update"),setTimeout((function(){$(".theme").addClass("quest-update"),$(".loop-count").text(s),F(".loop-scale")}),100),$(".theme").hasClass("quest-complete")||(s>=g.countLoopMax?($(".theme").addClass("quest-complete"),N("quest-complete"),$(".quest-subtitle").text(g.infoComplete),$(".loop-progress").attr("style",""),oe(),ie(),Z("quest-complete"),g.confetti.enable&&j(1,!0,"quest")):$(".loop-progress").css("stroke-dashoffset",o)))}function ie(){setTimeout((function(){$(".theme").addClass("exit"),N("quest-exit")}),g.timeExit),setTimeout((function(){g.status="rolling",$(".quest").hide(0),setTimeout((function(){te()}),g.timeRoll)}),g.timeExit+2e3)}function re(e){$(".reward-belt").html(""),$(".theme").removeClass("loading"),$(f.rewards).each((function(e,t){$(".reward-belt").append(k);const s=$(".reward").last(),o=f.numbers[e]==w.countLastMilestone;if(s.find(".reward-info").text(f.rewards[e]),f.numbers[e]){const t=w.setPrefix+f.numbers[e]+w.setSuffix;s.find(".bubble-number").text(t)}else s.find(".bubble-number").css("opacity","0"),s.find(".bubble-number").text("??");s.toggleClass("reward-mystery",f.mystery[e]),s.toggleClass("reward-last",o),D(s.find(".reward-info")),L(s.find(".reward-info"),2e3),"stretch"==f.origin[e]&&s.addClass("reward-stretch")}));const t=w.countShowTotal;$(".milestones").css("height","calc(80px * "+t+")"),function(){const e=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1];$(".reward-mystery").not(".reward-focus").each((function(t,s){const o=$(s);function a(){const t=$(o.find(".reward-info.blur span")),s=$(o.find(".bubble-number"));t.attr("style",""),t.removeClass("glitch"),s.removeClass("shine"),setTimeout((function(){s.addClass("shine")}),100),t.each((function(t,s){if(Math.floor(100*Math.random())<40){const t=Math.floor(Math.random()*e.length),o=e[t];$(s).addClass("glitch"),$(s).css("animation-delay",o+"s")}}))}D(o.find(".bubble-number")),L(o.find(".bubble-number"),300),a()}))}(),ne(),document.querySelectorAll(".reward-mystery .particles").forEach(((e,t)=>{e.id||(e.id=`particles-js-${t}`),particlesJS(e.id,{particles:{number:{value:2e3,density:{enable:!0,value_area:300}},color:{value:`${w.particleColor}`},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5},image:{src:"img/github.svg",width:100,height:100}},opacity:{value:1,random:!0,anim:{enable:!0,speed:2,opacity_min:0,sync:!1}},size:{value:1.5,random:!0,anim:{enable:!1,speed:30,size_min:.5,sync:!1}},line_linked:{enable:!1,distance:150,color:"#ffffff",opacity:.4,width:1},move:{enable:!0,speed:.5,direction:"none",random:!0,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!1,mode:"repulse"},onclick:{enable:!1,mode:"push"},resize:!0},modes:{grab:{distance:400,line_linked:{opacity:1}},bubble:{distance:400,size:40,duration:2,opacity:8,speed:3},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!1})})),"skip-animation"==e&&($(".milestones").find(".reward-complete").addClass("skip-animation"),$(".milestones").find(".reward-reveal").addClass("skip-animation"),$(".milestones").find(".exit").addClass("skip-animation"),$(".milestones").find(".enter").addClass("skip-animation"),$(".milestones").find(".reward-focus").addClass("skip-transition")),requestAnimationFrame((()=>{}))}function ne(){switch($(".reward").each((function(e,t){const s=f.numbers[e],o=$(t);s<=v.countPoints?(o.addClass("reward-complete"),o.hasClass("reward-mystery")&&$(t).find(".particles").fadeOut(2e3)):0==v.countPoints?($(".reward").removeClass("reward-complete"),$(".reward").removeClass("skip-animation"),$(".reward").removeClass("skip-transition")):o.removeClass("reward-complete")})),$(".reward-complete").length>0?($(".reward").removeClass("reward-focus"),$(".reward-complete").last().nextAll().first().addClass("reward-focus")):($(".reward").removeClass("reward-focus"),$(".reward").first().addClass("reward-focus")),0===w.countShowCompleted?(calcPrevCompleted=$(".reward-focus").prevAll().filter(".reward-complete").length,calcRewardEnter=w.countShowTotal-calcPrevCompleted-1):(calcPrevCompleted=$(".reward-focus").prevAll().filter(".reward-complete").slice(0,w.countShowCompleted).length,calcRewardEnter=w.countShowTotal-calcPrevCompleted-1),$(".reward").removeClass("showcase"),$(".reward-focus").nextAll().slice(0,calcRewardEnter).last().addClass("enter"),$(".reward-reveal").not(".reward-focus").not(".reward-complete").removeClass("reward-reveal"),$(".reward-mystery").not(".reward-reveal").not(".reward-complete").find(".particles").fadeIn(1e3),w.reveal){case"before":$(".reward-mystery").hasClass("reward-focus")&&($(".reward-mystery.reward-focus").addClass("reward-reveal"),$(".reward-mystery.reward-focus").find(".blur span").removeClass("glitch"),$(".reward-mystery.reward-focus").find(".particles").fadeOut(2e3),L(".reward-mystery.reward-focus .blur",2e3));break;case"after":$(".reward-mystery").hasClass("reward-complete")&&($(".reward-mystery.reward-complete").addClass("reward-reveal"),$(".reward-mystery.reward-complete").find(".blur span").removeClass("glitch"),$(".reward-mystery.reward-complete").find(".particles").fadeOut(2e3),L(".reward-mystery.reward-complete .blur",2e3),setTimeout((function(){$(".reward-mystery.reward-complete").addClass("reward-complete-after")}),5e3))}$(".reward").removeClass("exit gone"),0===w.countShowCompleted?$(".reward-complete").addClass("gone"):$(".reward-complete").slice(0,-w.countShowCompleted).addClass("gone");const e=$(".reward-belt").children().slice(-w.countShowTotal).first();0===w.countShowCompleted?$(".reward-complete").addClass("exit"):e.hasClass("gone")||$(".reward-complete").slice(0,-w.countShowCompleted).addClass("exit");let t=-80*$(".reward.gone").length,s=80*-($(".reward").length-w.countShowTotal);t<=s?$(".reward-belt").css("transform","translateY("+s+"px)"):$(".reward-belt").css("transform","translateY("+t+"px)"),requestAnimationFrame((()=>{}))}function le(e){b={rewards:[],numbers:[],mystery:[],origin:[]},"reset"!=e&&$(f.rewards).each((function(e,t){const s=f.rewards[e],o=f.numbers[e],a=f.mystery[e],i=f.origin[e];"stretch"==i&&(b.rewards.push(s),b.numbers.push(o),b.mystery.push(a),b.origin.push(i))})),"reset"==e&&(f.rewards=f.rewards.filter(((e,t)=>"stretch"!=f.origin[t])),f.numbers=f.numbers.filter(((e,t)=>"stretch"!=f.origin[t])),f.mystery=f.mystery.filter(((e,t)=>"stretch"!=f.origin[t])),f.origin=f.origin.filter((e=>"stretch"!=e)),$(".reward").removeClass("skip-animation"),$(".reward").removeClass("skip-transition")),I()}function ue(){if(f){$(".bar").html("");for(let e=0;e<f.rewards.length;e++)$(".bar").append(T)}}function me(e,t){$(".theme").removeClass("loading");let s=0;if(0!=e){const e=v.countPoints,o=v.enableDecimals?e%1!=0?e.toFixed(2):e:Math.floor(e);$(".sub-count").text(o),"milestones"==v.styleData&&$(".sub-goals").text(f.numbers.at(-1)),t||(I(),N("progress-pointsTotal")),$(f.numbers).each((function(e,t){if(!(v.countPoints>=t)){const o=0===e?0:f.numbers[e-1],a=t-o,i=v.countPoints-o;return s+=i/a*100,!1}s+=100,$(".left  .bar-dot").eq(e).addClass("bar-complete"),$(".right .bar-dot").eq(e).addClass("bar-complete"),v.countProgressCurrent=t})),v.countProgressCurrent!=v.countProgressPrevious&&(v.countProgressPrevious=v.countProgressCurrent,$(".center-dot").removeClass("bar-complete"),setTimeout((function(){$(".center-dot").addClass("bar-complete")}),100)),$(".progress-belt").css("transform","translateX(-"+s+"px)")}}window.addEventListener("onWidgetLoad",(function(s){const o=s.detail.fieldData;function a(){f.rewards=_(o,"msRewards_"),f.numbers=_(o,"msNumbers_"),f.mystery=_(o,"msMystery_"),function(e){const t=Object.values(e),s=t[0];if(Array.isArray(s))for(let t=s.length-1;t>=0;t--)if(""===s[t]||null==s[t])for(const s in e)Array.isArray(e[s])&&e[s].splice(t,1)}(f),w.reveal=o.setMilestonesReveal,w.particleColor=o.particleColor,w.countShowTotal=o.countShowTotal,w.countShowCompleted=o.countShowCompleted,w.countLastMilestone=f.numbers.at(-1),w.setPrefix=o.setMilestonesPrefix,w.setSuffix=o.setMilestonesSuffix,w.commands.commandAdd=o.cmdMilestoneAdd,w.commands.commandRemove=o.cmdMilestoneRemove,w.commands.commandReset=o.cmdMilestoneReset,w.commands.permissions.mods=o.permsMilestonesMod,w.commands.permissions.users=G(o.permsMilestonesUsers)}c.id=s.detail.channel.id,c.koofee=o.userKofi,s.detail.channel.avatar.includes("static-cdn.jtvnw.net")&&(c.platform.twitch=!0,c.platform.youtube=!1),s.detail.channel.avatar.includes("yt3.ggpht.com")&&(c.platform.twitch=!1,c.platform.youtube=!0,h.values.subs.tier1=h.values.members,h.values.subs.tier2=h.values.members,h.values.subs.tier3=h.values.members,h.values.gift.tier1=h.values.members,h.values.gift.tier2=h.values.members,h.values.gift.tier3=h.values.members),setTimeout((function(){R&&(SE_API.store.get("fn_megathon_bubblepop").then((e=>{if(null!==e&&Object.keys(e).length>0)console.log("%c✨ SE HISTORY LOADED","color: #f9c23c",e),y&&e.status&&(h.status=[...e.status],J("load",!0)),S&&(e.milestonesStretch?(b={...e.milestonesStretch},t=f,(s=b).numbers.forEach(((e,o)=>{const a=t.numbers.findIndex((t=>t>e)),i=-1===a?t.numbers.length:a;t.numbers.splice(i,0,s.numbers[o]),t.rewards.splice(i,0,s.rewards[o]),t.mystery.splice(i,0,s.mystery[o]),t.origin.splice(i,0,s.origin[o])})),re(),le(),N("milestones-list")):(re(),le(),N("milestones-list")),null!=e.countPoints?(v.countPoints=e.countPoints,ne()):ne()),E&&(e.milestones?(f={...e.milestones},ue()):ue(),null!=e.countPoints?(v.countPoints=e.countPoints,me(!0,!0)):me(!0,!0));else{console.log("%c✨ SE HISTORY EMPTY, CREATING NEW","color: #f9c23c"),re(),ne(),ue(),me(!0,!0);const e={status:[...h.status],milestones:{...f},milestonesStretch:{...b},countPoints:v.countPoints};SE_API.store.set("fn_megathon_bubblepop",e)}var t,s})),t=new EventBridgeAPI(c.id),t.on("onMessage",((e,t)=>{if("CustomEvent"==t.type){const e=t.params.megathon_bubblepop;S&&void 0!==e.pointsTotal&&(v.countPoints=e.pointsTotal,!0===w.startup&&(w.startup=!1,re("skip-animation")),ne()),E&&e.milestones&&(f={...e.milestones},ue(e.milestones),me(!0))}})),t.on("onError",(e=>{console.error("WebSocket error:",e)}))),q&&(c.koofee?(O("🍵 KOFI","CONNECTED","#86d72f"),function(){class e{BASE_URL="https://koofee.helba.ai";WEBSOCKET_URL="wss://koofee.helba.ai/ws";constructor(e){this.user=e,this.ws=null,this.autoReconnectInterval=5e3,this.callbacks={onMessage:null,onError:null,onOpen:null,onClose:null},this.connectWebSocket()}connectWebSocket(){this.ws=new WebSocket(`${this.WEBSOCKET_URL}/${this.user}`),this.ws.onopen=e=>{this.callbacks.onOpen&&this.callbacks.onOpen(e),console.log("WebSocket connected")},this.ws.onmessage=e=>{this.callbacks.onMessage&&this.callbacks.onMessage(e,JSON.parse(e.data))},this.ws.onerror=e=>{this.callbacks.onError&&this.callbacks.onError(e),console.error("WebSocket error:",e)},this.ws.onclose=e=>{this.callbacks.onClose&&this.callbacks.onClose(e),console.log("WebSocket closed. Reconnecting..."),setTimeout((()=>this.connectWebSocket()),this.autoReconnectInterval)}}on(e,t){this.callbacks.hasOwnProperty(e)?this.callbacks[e]=t:console.error(`Unsupported event: ${e}`)}async triggerEvent(e){try{const t=await fetch(`${this.BASE_URL}/custom_event/${this.user}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.text();console.log(s)}catch(e){console.error("Error resuming timer:",e)}}}apiKoofee=new e(c.koofee),apiKoofee.on("onMessage",((e,t)=>{if("Donation"===t.type){const e=t.from_name,s=Math.round(t.amount);if(y){console.log("%c🍵 KOFI = %c"+e,"color: #86d72f","color: #fff"),console.log("%c🍵 KOFI = %cDONATION","color: #86d72f","color: #fff");let t=h.values.kofi.tips*s;h.modePowerup.multiplierEvent=h.modePowerup.events.includes("kofi")?h.modePowerup.multiplier:1,A("add",t,void 0,"kofi"),H(e,s,"tips",t)}E&&(v.countPoints+=v.points.kofi.tips*s,me(v.points.kofi.tips)),x&&ae(g.points.kofi.tips*s)}if("Subscription"===t.type){const e=t.from_name,s=Math.round(t.amount);if(y){console.log("%c🍵 KOFI = %c"+e,"color: #86d72f","color: #fff"),console.log("%c🍵 KOFI = %cSUBSCRIPTION","color: #86d72f","color: #fff");let t=h.values.kofi.subs*s;h.modePowerup.multiplierEvent=h.modePowerup.events.includes("kofi")?h.modePowerup.multiplier:1,A("add",t,void 0,"kofi"),H(e,s,"tips",t)}E&&(v.countPoints+=v.points.kofi.subs*s,me(v.points.kofi.subs)),x&&ae(g.points.kofi.subs*s)}}))}()):O("🍵 KOFI","TOKEN MISSING","#a7a8b7")),y&&y&&(e=new CountdownTimerAPI(c.id),e.on("onOpen",(()=>{console.log("WebSocket connection opened."),y&&($(".theme").removeClass("loading"),h.startup=!1)})),e.on("onMessage",(e=>{if(!h.startup){const t=parseInt(e.data.split("|")[0]),s=e.data.split("|")[1],o="paused"==s,a="running"==s,i=t===h.countTimerReset,r=t<=h.countTimerWarning+60,n=t>=h.countTimerMax,l=0===t,u=h.status.includes("warning"),m=h.status.includes("maxed"),c=h.status.includes("zero");i&&o&&!$(".timer").hasClass("timer-reset")?($(".timer").removeClass("timer-warning"),$(".timer").removeClass("timer-maxed"),$(".timer").removeClass("timer-zero"),$(".timer").addClass("timer-reset"),Y(t)):!i&&o?($(".timer").removeClass("timer-reset"),$(".timer").addClass("timer-pause")):o&&$(".timer").addClass("timer-pause"),r&&!l&&!u&&a?($(".timer").addClass("timer-warning"),h.status.push("warning"),ee()):r||X("warning"),n&&!m&&h.setTimerMax?($(".timer").addClass("timer-maxed"),h.status.push("maxed"),J("lock",!0),Y(h.countTimerMax),h.confetti.maxed.enable&&j(h.confetti.maxed.loop,!0,"timer-maxed"),setTimeout((function(){A("custom",h.countTimerMax)}),4e3),setTimeout((function(){A("resume")}),5e3)):n||X("maxed"),!l||c||h.startup?l||X("zero"):($(".timer").addClass("timer-zero"),h.status.push("zero"),ee(),Y(0),h.setLockZero&&J("lock",!0),N("timer-zero")),$(".timer").hasClass("timer-maxed")||i||Y(t)}})),e.on("onClose",(()=>{console.log("WebSocket connection closed.")})),e.on("onError",(e=>{console.error("WebSocket error:",e)}))),y&&(c.symbol=s.detail.currency.symbol,h.welcome.name=o.welcomeName,h.welcome.number=o.welcomeNumber,h.style=o.style,h.setLockZero=o.setLockZero,h.setTimerMax=o.setTimerMax,h.setTimerDivider=o.setTimerDivider,h.countTimerMax=Q(o.countTimerMax),h.countTimerWarning=Q(o.countTimerWarning),h.countTimerReset=Q(o.countTimerReset),h.countTimerCustom=Q(o.countTimerCustom),h.values.subs.tier1=W(o.valuesSubsTier1),h.values.subs.tier2=W(o.valuesSubsTier2),h.values.subs.tier3=W(o.valuesSubsTier3),h.values.gift.tier1=W(o.valuesGiftTier1),h.values.gift.tier2=W(o.valuesGiftTier2),h.values.gift.tier3=W(o.valuesGiftTier3),h.values.tips=W(o.valuesTips),h.values.bits=W(o.valuesBits),h.values.follow=W(o.valuesFollow),h.values.raid=W(o.valuesRaid),h.values.members=W(o.valuesMembers),h.values.superchat=W(o.valuesSuperchat),h.modePowerup.commandEnable=o.cmdPowerupEnable,h.modePowerup.commandDisable=o.cmdPowerupDisable,h.modePowerup.permissions.mods=o.permsPowerupMod,h.modePowerup.permissions.users=G(o.permsPowerupUsers),h.modeSleep.commandEnable=o.cmdSleepEnable,h.modeSleep.commandDisable=o.cmdSleepDisable,h.modeSleep.multiplierReset=o.countSleepMultiplierReset,h.modeSleep.permissions.mods=o.permsSleepMod,h.modeSleep.permissions.users=G(o.permsSleepUsers),h.commands.resume=o.cmdResume,h.commands.pause=o.cmdPause,h.commands.add=o.cmdAdd,h.commands.subtract=o.cmdSubtract,h.commands.lock.commandEnable=o.cmdLockEnable,h.commands.lock.commandDisable=o.cmdLockDisable,h.commands.permissions.mods=o.permsTimerMod,h.commands.permissions.users=G(o.permsTimerUsers),h.audio.resume.path=o.audioResumePath,h.audio.resume.volume=o.audioResumeVolume/100,h.audio.pause.path=o.audioPausePath,h.audio.pause.volume=o.audioPauseVolume/100,h.audio.zero.path=o.audioZeroPath,h.audio.zero.volume=o.audioZeroVolume/100,h.setManualTime=W(o.setManualTime),h.values.kofi.tips=W(o.valuesKofiTips),h.values.kofi.subs=W(o.valuesKofiSubs),flatlineResize()),x&&(p.rewards=G(o.listQuestRewards),C=[...p.rewards],g.enable=o.setQuestEnable,g.testing=o.setQuestTesting,g.emulate=o.setQuestEmulate,g.style=o.style,g.countChance=o.countChance,g.countLoopMax=o.countLoopMax,g.timeRoll=6e4*o.timeRoll,g.timeExit=1e3*o.timeExit,g.timeWarning=o.timeWarning,g.timeExpire=o.timeExpire,g.infoSubtitle=o.infoSubtitle,g.infoFailed=o.infoFailed,g.infoComplete=o.infoComplete,g.infoBubbleLabel=o.infoBubbleLabel,g.audio.appear.path=o.audioAppearPath,g.audio.appear.volume=o.audioAppearVolume/100,g.audio.warning.path=o.audioWarningPath,g.audio.warning.volume=o.audioWarningVolume/100,g.audio.failed.path=o.audioFailedPath,g.audio.failed.volume=o.audioFailedVolume/100,g.audio.complete.path=o.audioCompletePath,g.audio.complete.volume=o.audioCompleteVolume/100,g.commands.commandEnable=o.cmdQuestEnable,g.commands.commandDisable=o.cmdQuestDisable,g.commands.permissions.mods=o.permsQuestMod,g.commands.permissions.users=G(o.permsQuestUsers),g.points.subs.tier1=o.pointsSubsTier1,g.points.subs.tier2=o.pointsSubsTier2,g.points.subs.tier3=o.pointsSubsTier3,g.points.gift.tier1=o.pointsGiftTier1,g.points.gift.tier2=o.pointsGiftTier2,g.points.gift.tier3=o.pointsGiftTier3,g.points.tips=o.pointsTips,g.points.bits=o.pointsBits,g.points.follow=o.pointsFollow,g.points.raid=o.pointsRaid,g.points.kofi.tips=o.pointsKofiTips,g.points.kofi.subs=o.pointsKofiSubs,flatlineResize(["center","center"])),S&&(a(),flatlineResize(["center","center"])),E&&(v.style=o.style,v.styleData=o.styleData,v.countPointsMax=o.countPointsMax,v.enableDecimals=o.enableDecimals,v.points.subs.tier1=o.pointsSubsTier1,v.points.subs.tier2=o.pointsSubsTier2,v.points.subs.tier3=o.pointsSubsTier3,v.points.gift.tier1=o.pointsGiftTier1,v.points.gift.tier2=o.pointsGiftTier2,v.points.gift.tier3=o.pointsGiftTier3,v.points.tips=o.pointsTips,v.points.bits=o.pointsBits,v.points.follow=o.pointsFollow,v.points.raid=o.pointsRaid,v.commands.add=o.cmdProgressAdd,v.commands.subtract=o.cmdProgressSubtract,v.commands.set=o.cmdProgressSet,v.commands.reset=o.cmdProgressReset,v.commands.permissions.mods=o.permsProgressMod,v.commands.permissions.users=G(o.permsProgressUsers),v.points.kofi.tips=o.pointsKofiTips,v.points.kofi.subs=o.pointsKofiSubs,flatlineResize(["center","center"])),function(){if($(".theme").addClass("set-timer-"+h.style),$(".theme").addClass("set-progress-"+v.style),$(".theme").addClass("set-progress-"+v.styleData),$(".theme").toggleClass("set-timer-divider",h.setTimerDivider),$(".timer .event.name").text(h.welcome.name),$(".timer .event.number").text(h.welcome.number),$(".quest .quest-subtitle").text(g.infoSubtitle),$(".quest .bubble-subtitle").text(g.infoBubbleLabel),$(".quest .bubble-number").text(g.countLoopMax),$(".effects").toggleClass("hide",!g.effects.enable),$(".milestones").addClass("set-reveal-"+w.reveal),$(".set-progress-goal .progress .sub-goals").text(v.countPointsMax),$(".audio-timer-resume").attr("src",h.audio.resume.path),$(".audio-timer-pause").attr("src",h.audio.pause.path),$(".audio-timer-zero").attr("src",h.audio.zero.path),$(".audio-quest-appear").attr("src",g.audio.appear.path),$(".audio-quest-warning").attr("src",g.audio.warning.path),$(".audio-quest-failed").attr("src",g.audio.failed.path),$(".audio-quest-complete").attr("src",g.audio.complete.path),x)if(g.testing)switch($(".theme").addClass("enter"),$(".quest-title").text(B(p.rewards)[0]),$(".quest-timer").text("11:56"),$(".loop-progress").css("stroke-dasharray",94.5),$(".loop-count").text("11"),g.emulate){case"default":break;case"complete":$(".theme").addClass("quest-complete"),$(".quest-subtitle").text(g.infoComplete);break;case"failed":$(".theme").addClass("quest-failed"),$(".quest-subtitle").text(g.infoFailed);break;case"warning":$(".theme").addClass("quest-warning")}else $(".quest").hide(0),g.enable&&(console.log("%c✨ QUEST → %cENABLED","color: #fff","color: #a7ebb3"),console.log("%c✨ QUEST → %cROLLING IN "+z(g.timeRoll/1e3).all,"color: #fff","color: #a7ebb3"),setTimeout((function(){te()}),g.timeRoll))}()}),1e3)})),window.addEventListener("onEventReceived",(function(e){const t=e.detail.listener,o=e.detail.event,a=`${e.detail.event.name}_${e.detail.event.amount}_${function(){const e=new Date;let t=5*Math.ceil(e.getSeconds()/5);return 60===t&&(e.setMinutes(e.getMinutes()+1),t=0),e.setSeconds(t),e.setMilliseconds(0),e.toISOString().split(".")[0]+"Z"}()}`,i=e.detail.event._id?e.detail.event._id:a;if("kvstore:update"!==t){if("widget-button"===e.detail.event.listener){if(y)switch(e.detail.event.field){case"buttonTimerResume":A("resume"),Z("timer-resume");break;case"buttonTimerPause":A("pause"),Z("timer-pause");break;case"buttonTimerAdd":A("add",h.setManualTime,i,{type:"button",field:o.field});break;case"buttonTimerSubtract":A("subtract",h.setManualTime,i,{type:"button",field:o.field});break;case"buttonTimerReset":A("reset",h.countTimerReset);break;case"buttonTimerCustom":A("custom",h.countTimerCustom)}if(x&&"buttonQuestRoll"===e.detail.event.field&&($(".theme").removeClass("quest-failed quest-warning quest-complete quest-update"),$(".theme").removeClass("enter exit"),g.status="rolling",setTimeout((function(){te(!0),oe()}),100)),E&&!$(".theme").hasClass("loading"))switch(e.detail.event.field){case"buttonProgressAdd1":v.countPoints+=1,v.countPoints<0&&(v.countPoints=0),me(!0);break;case"buttonProgressAdd5":v.countPoints+=5,v.countPoints<0&&(v.countPoints=0),me(!0);break;case"buttonProgressSubtract1":v.countPoints-=1,v.countPoints<0&&(v.countPoints=0),me(!0);break;case"buttonProgressSubtract5":v.countPoints-=5,v.countPoints<0&&(v.countPoints=0),me(!0);break;case"buttonProgressReset":v.countPoints=0,me(!0)}}if(q&&c.platform.twitch){if("subscriber-latest"===t&&(o.bulkGifted?(y&&O("🎁 EVENT GIFT",[o.sender,o.amount],"#00cafe"),h.modePowerup.multiplierEvent=h.modePowerup.events.includes("gift")?h.modePowerup.multiplier:1,r("gift")):o.isCommunityGift||(y&&O("⭐ EVENT SUB",[o.name,o.amount],"#00cafe"),h.modePowerup.multiplierEvent=h.modePowerup.events.includes("subs")?h.modePowerup.multiplier:1,r("subs"))),"cheer-latest"===t){const n=o.amount/100;if(y){O("🔷 EVENT BITS",[o.name,o.amount],"#00cafe");let l=h.values.bits*n;h.modePowerup.multiplierEvent=h.modePowerup.events.includes("bits")?h.modePowerup.multiplier:1,A("add",l,i,{type:"bits",name:o.name,number:o.amount,time_value:h.values.bits}),H(o.name,o.amount,"bits",l)}E&&(v.countPoints+=v.points.bits*n,me(v.points.bits)),x&&ae(g.points.bits*n)}if("follower-latest"===t&&(y&&(O("💜 EVENT FOLLOW",[o.name],"#00cafe"),h.modePowerup.multiplierEvent=h.modePowerup.events.includes("follow")?h.modePowerup.multiplier:1,A("add",h.values.follow,i,{type:"follow",name:o.name,time_value:h.values.follow}),H(o.name,"","follow",h.values.follow)),E&&(v.countPoints+=v.points.follow,me(v.points.follow)),x&&ae(g.points.follow)),"raid-latest"===t){if(y){O("⚔️ EVENT RAID",[o.name,o.amount],"#00cafe");let u=h.values.raid;h.modePowerup.multiplierEvent=h.modePowerup.events.includes("raid")?h.modePowerup.multiplier:1,A("add",u,i,{type:"raid",name:o.name,number:o.amount,time_value:h.values.raid}),H(o.name,o.amount,"raid",u)}E&&(v.countPoints+=v.points.raid,me(v.points.raid)),x&&ae(g.points.raid)}}if(q&&c.platform.youtube){if("sponsor-latest"===t&&!0!==o.isCommunityGift&&(y&&O("⭐ EVENT SPONSOR",[o.name,o.amount],"#00cafe"),h.modePowerup.multiplierEvent=h.modePowerup.events.includes("subs")?h.modePowerup.multiplier:1,r("subs")),"subscriber-latest"!==t||o.tier||o.bulkGifted&&(y&&O("🎁 EVENT SPONSOR GIFT",[o.sender,o.amount],"#00cafe"),h.modePowerup.multiplierEvent=h.modePowerup.events.includes("gift")?h.modePowerup.multiplier:1,r("gift")),"superchat-latest"===t){const m=Math.round(o.amount);if(y){O("🔷 EVENT SUPERCHAT",[o.name,o.amount],"#00cafe");let d=h.values.superchat*m;h.modePowerup.multiplierEvent=h.modePowerup.events.includes("bits")?h.modePowerup.multiplier:1,A("add",d,i),H(o.name,o.amount,"bits",d)}E&&(v.countPoints+=v.points.superchat*m,me(v.points.superchat)),x&&ae(g.points.superchat*m)}"subscriber-latest"===t&&o.tier&&(y&&(O("💜 EVENT SUB FOLLOW",[o.name,o.amount],"#00cafe"),h.modePowerup.multiplierEvent=h.modePowerup.events.includes("follow")?h.modePowerup.multiplier:1,A("add",h.values.follow,i),H(o.name,"","follow",h.values.follow)),E&&(v.countPoints+=v.points.follow,me(v.points.follow)),x&&ae(g.points.follow))}
if(q && "tip-latest" === t){
  const p = o.amount;
  const exchangeRate = 23.5; // aktuální kurz USD → CZK
  const amountCZK = p * exchangeRate;

  if(y){
    O("💰 EVENT TIP", [o.name, amountCZK.toFixed(0) + " Kč"], "#00cafe");
    let b = h.values.tips * amountCZK;
    h.modePowerup.multiplierEvent = h.modePowerup.events.includes("tips") ? h.modePowerup.multiplier : 1;
    A("add", b, i, { type: "tips", name: o.name, number: amountCZK, time_value: h.values.tips });
    H(o.name, amountCZK.toFixed(0), "tips", b);
  }

  if(E){
    v.countPoints += v.points.tips * amountCZK;
    me(v.points.tips);
  }

  if(x){
    ae(g.points.tips * amountCZK);
  }
}
h.modePowerup.multiplierEvent=h.modePowerup.events.includes("tips")?h.modePowerup.multiplier:1,A("add",b,i,{type:"tips",name:o.name,number:o.amount,time_value:h.values.tips}),H(o.name,o.amount,"tips",b)}E&&(v.countPoints+=v.points.tips*p,me(v.points.tips)),x&&ae(g.points.tips*p)}if("message"===t){const C={message:e.detail.event.data.text,channel:e.detail.event.data.channel,userRaw:e.detail.event.data.nick,userDis:e.detail.event.data.displayName,userInk:e.detail.event.data.displayColor.toLowerCase(),userMod:K(e.detail.event.data.tags.mod),userSub:K(e.detail.event.data.tags.subscriber),userVIP:K(e.detail.event.data.tags.vip)},P=C.userRaw===C.channel,k=C.userMod,T=c.usersForce.includes(C.userRaw),M=e.detail.event.data.msgId;function R(e){const t=C.message.toLowerCase(),s=e.toLowerCase();return t===s||t.startsWith(s+" ")}if(y){if((P||T||k&&h.commands.permissions.mods||h.commands.permissions.users.includes(C.userRaw))&&(R(h.commands.resume)&&(A("resume"),Z("timer-resume")),R(h.commands.pause)&&(A("pause"),Z("timer-pause")),R(h.commands.add)&&A("add",W(C.message.slice(h.commands.add.length).trim()),M,{type:"chat command",...C}),R(h.commands.subtract)&&A("subtract",W(C.message.slice(h.commands.subtract.length).trim()),M,{type:"chat command",...C}),R(h.commands.lock.commandEnable)&&J("lock",!0),R(h.commands.lock.commandDisable)&&J("lock",!1)),P||T||k&&h.modePowerup.permissions.mods||h.modePowerup.permissions.users.includes(C.userRaw)){if(R(h.modePowerup.commandEnable)){console.log("%c💢 POWERUP → %cENABLED","color: #fff","color: #a7ebb3");const _=function(e,t){const s=new RegExp(`^${e} \\[(.*?)\\] \\[(.*?)\\](?: \\[(.*?)\\])?$`),o=t.match(s);if(o){const e=o[3]?o[3].split(",").map((e=>e.trim())):["subs","gift","bits","tips","follow"];return{multiplier:parseFloat(o[1]),duration:o[2],events:e}}return null}(h.modePowerup.commandEnable,C.message);J("powerup",!0,_.multiplier,_.duration,_.events)}R(h.modePowerup.commandDisable)&&(console.log("%c💢 POWERUP → %cDISABLED","color: #fff","color: #ff5353"),J("powerup",!1))}(P||T||k&&h.modeSleep.permissions.mods||h.modeSleep.permissions.users.includes(C.userRaw))&&(R(h.modeSleep.commandEnable)&&J("sleep",!0),R(h.modeSleep.commandDisable)&&J("sleep",!1))}x&&(P||T||k&&g.commands.permissions.mods||g.commands.permissions.users.includes(C.userRaw))&&(R(g.commands.commandEnable)&&(console.log("%c❓ QUEST → %cENABLED","color: #fff","color: #a7ebb3"),g.enable=!0),R(g.commands.commandDisable)&&(console.log("%c❓ QUEST → %cDISABLED","color: #fff","color: #ff5353"),g.enable=!1)),S&&(P||T||k&&w.commands.permissions.mods||w.commands.permissions.users.includes(C.userRaw))&&(R(w.commands.commandAdd)&&function(e){const t=new RegExp(`^${w.commands.commandAdd} \\[(.*?)\\] \\[(.*?)\\]$`),s=e.match(t);if(s){const e=s[1],t=parseInt(s[2],0),o=f.numbers.indexOf(t);if("fields"!==f.origin[o])if(-1!==o)f.rewards[o]=e,re("skip-animation"),le(),N("milestones-list");else{let s=f.numbers.findIndex((e=>e>t));-1===s?(f.numbers.push(t),f.rewards.push(e),f.mystery.push(!1),f.origin.push("stretch"),re("skip-animation"),le(),N("milestones-list")):(f.numbers.splice(s,0,t),f.rewards.splice(s,0,e),f.mystery.splice(s,0,!1),f.origin.splice(s,0,"stretch"),re("skip-animation"),le(),N("milestones-list"))}}requestAnimationFrame((()=>{}))}(C.message),R(w.commands.commandRemove)&&function(e){const t=new RegExp(`^${w.commands.commandRemove} \\[(.*?)\\]$`),s=e.match(t);if(s){const e=parseInt(s[1],0),t=f.numbers.indexOf(e),o=f.origin[t];-1!==t&&"fields"!==o?(f.numbers.splice(t,1),f.rewards.splice(t,1),f.mystery.splice(t,1),f.origin.splice(t,1),re(),console.log(`Milestone with number ${e} removed.`),console.log("Updated Milestones:",f)):console.log(`Milestone with number ${e} does not exist.`)}requestAnimationFrame((()=>{}))}(C.message),R(w.commands.commandReset)&&(le("reset"),N("milestones-list"))),E&&(P||T||k&&v.commands.permissions.mods||v.commands.permissions.users.includes(C.userRaw))&&(R(v.commands.add)&&(v.countPoints+=V(C.message),v.countPoints<0&&(v.countPoints=0),me(!0)),R(v.commands.subtract)&&(v.countPoints-=V(C.message),v.countPoints<0&&(v.countPoints=0),me(!0)),R(v.commands.set)&&(v.countPoints=V(C.message),v.countPoints<0&&(v.countPoints=0),me(!0)),R(v.commands.reset)&&(v.countPoints=0,me(!0)))}}function r(e){switch(e){case"subs":valTimer=h.values.subs,valProgress=v.points.subs,valQuest=g.points.subs,s=1,countPointsMultiplier=1,infoName=o.name;break;case"gift":valTimer=h.values.gift,valProgress=v.points.gift,valQuest=g.points.gift,s=o.amount,countPointsMultiplier=o.amount,infoName=o.sender}switch(parseInt(o.tier)){case 3e3:y&&(console.log("%c🔅 TIER = %c3000","color: #00cafe","color: #fff"),valTimerTier=valTimer.tier3),E&&(v.countPoints+=valProgress.tier3*countPointsMultiplier,me(valProgress.tier3)),x&&ae(valQuest.tier3*countPointsMultiplier);break;case 2e3:y&&(console.log("%c🔅 TIER = %c2000","color: #00cafe","color: #fff"),valTimerTier=valTimer.tier2),E&&(v.countPoints+=valProgress.tier2*countPointsMultiplier,me(valProgress.tier2)),x&&ae(valQuest.tier2*countPointsMultiplier);break;default:y&&(console.log("%c🔅 TIER = %c1000","color: #00cafe","color: #fff"),valTimerTier=valTimer.tier1),E&&(v.countPoints+=valProgress.tier1*countPointsMultiplier,me(valProgress.tier1)),x&&ae(valQuest.tier1*countPointsMultiplier)}y&&(A("add",valTimerTier*s,i,{type:e,tier:o.tier??"",name:infoName,number:countPointsMultiplier,time_value:valTimerTier}),H(infoName,s,e,valTimerTier))}}));
